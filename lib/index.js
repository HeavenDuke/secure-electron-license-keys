"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=exports.clearMainBindings=exports.mainBindings=exports.preloadBindings=exports.validate=exports.validateLicenseResponse=exports.validateLicenseRequest=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var path=require("path"),validateLicenseRequest="ValidateLicense-Request";exports.validateLicenseRequest=validateLicenseRequest;var validateLicenseResponse="ValidateLicense-Response";exports.validateLicenseResponse="ValidateLicense-Response";var parseVersion=function(a){if(!a||5>a.length)return console.warn("Could not parse version since ".concat(a," doesn't seem to follow semver specifications.")),a;var b=a.split(".");return 3===b.length?{major:b[0],minor:b[1],patch:b[2]}:a},validate=function(a,b,c){var d={success:!1,appVersion:parseVersion(c.version)},e=path.join(c.root,"public.key"),f=path.join(c.root,"license.data");try{if(a.existsSync(e)&&a.existsSync(f)){var g=a.readFileSync(e),h=a.readFileSync(f),i=b.publicDecrypt(g,h);Object.assign(d,JSON.parse(i.toString("utf8"))),d.success=!0}}catch(a){console.error(a)}return d};exports.validate=validate;var preloadBindings=function(a){return{send:function send(b){[validateLicenseRequest].includes(b)&&a.send(b)},onReceive:function onReceive(b,c){[validateLicenseResponse].includes(b)&&a.on(b,function(a,b){return c(b)})},clearRendererBindings:function clearRendererBindings(){a.removeAllListeners(validateLicenseResponse)}}};exports.preloadBindings=preloadBindings;var mainBindings=function(a,b,c,d,e){if(!e)throw"options must be defined in order for license key validation to work!";else if("undefined"==typeof e.root)throw"options must contain a value for 'root'. We suggest 'process.cwd()'.";else"undefined"==typeof e.version&&console.warn("By not passing a 'version' property, the client side code will not be able to make determinations based on this value. We suggest 'app.getVersion()'.");a.on(validateLicenseRequest,function(){var a=validate(c,d,e);b.webContents.send(validateLicenseResponse,a)})};exports.mainBindings=mainBindings;var clearMainBindings=function(a){a.removeAllListeners(validateLicenseRequest)};exports.clearMainBindings=clearMainBindings;var SecureElectronLicenseKeys=function a(){_classCallCheck(this,a)},_default=SecureElectronLicenseKeys;exports["default"]=_default;